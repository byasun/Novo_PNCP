{% extends "base.html" %}

{% block title %}Novo Usuário{% endblock %}

{% block content %}
<!-- Formulário de criação de usuário (apenas logado) -->
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-person-plus"></i> Criar usuário</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    <!-- Token CSRF obrigatório -->
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-3">
                        <label class="form-label">Usuário</label>
                        <input type="text" class="form-control" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-control" name="password" id="password" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Confirmar senha</label>
                        <input type="password" class="form-control" name="confirm_password" id="confirm_password" required>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Critérios da senha:</small>
                        <ul class="small mt-2 mb-0">
                            <li id="rule-length" class="text-muted">Mínimo de 6 caracteres</li>
                            <li id="rule-upper" class="text-muted">Pelo menos uma letra maiúscula</li>
                            <li id="rule-lower" class="text-muted">Pelo menos uma letra minúscula</li>
                            <li id="rule-number" class="text-muted">Pelo menos um número</li>
                            <li id="rule-special" class="text-muted">Pelo menos um caractere especial</li>
                            <li id="rule-match" class="text-muted">Senhas iguais</li>
                        </ul>
                    </div>
                    <button type="submit" class="btn btn-success w-100" id="btnCreate" disabled>
                        <i class="bi bi-check-circle"></i> Criar usuário
                        <span id="btnHint" class="d-block small text-light mt-1">Preencha a senha conforme os critérios</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const passwordInput = document.getElementById('password');
const confirmInput = document.getElementById('confirm_password');
const btnCreate = document.getElementById('btnCreate');
const btnHint = document.getElementById('btnHint');

function setRuleState(id, ok) {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.toggle('text-success', ok);
    el.classList.toggle('text-muted', !ok);
    el.classList.toggle('text-danger', !ok && (passwordInput.value.length > 0 || confirmInput.value.length > 0));
}

function validatePassword() {
    const password = passwordInput.value || '';
    const confirm = confirmInput.value || '';

    const validLength = password.length >= 6;
    const validUpper = /[A-Z]/.test(password);
    const validLower = /[a-z]/.test(password);
    const validNumber = /\d/.test(password);
    const validSpecial = /[^A-Za-z0-9]/.test(password);
    const validMatch = password.length > 0 && password === confirm;

    setRuleState('rule-length', validLength);
    setRuleState('rule-upper', validUpper);
    setRuleState('rule-lower', validLower);
    setRuleState('rule-number', validNumber);
    setRuleState('rule-special', validSpecial);
    setRuleState('rule-match', validMatch);

    const isValid = validLength && validUpper && validLower && validNumber && validSpecial && validMatch;
    btnCreate.disabled = !isValid;
    btnHint.textContent = isValid
        ? 'Senha válida. Você pode criar o usuário.'
        : 'Preencha a senha conforme os critérios';
}

passwordInput.addEventListener('input', validatePassword);
confirmInput.addEventListener('input', validatePassword);
document.addEventListener('DOMContentLoaded', validatePassword);
</script>
{% endblock %}
